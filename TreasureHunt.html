<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>秘境寻踪 - 寻宝体验</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --accent: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --text: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--dark) 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }
        
        /* 地图区域 */
        .map-section {
            padding: 25px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .map-container {
            width: 100%;
            height: 400px;
            background: #e9f2fa;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            border: 2px solid #d6e4f0;
        }
        
        .map-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(#d6e4f0 1px, transparent 1px),
                linear-gradient(90deg, #d6e4f0 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0.5;
        }
        
        .location {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            border: 3px solid white;
        }
        
        .location:hover {
            transform: scale(1.05);
        }
        
        .location.active {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 20;
        }
        
        .library { top: 15%; left: 20%; background: #e67e22; color: white; }
        .cave { top: 35%; left: 70%; background: #7f8c8d; color: white; }
        .temple { top: 65%; left: 40%; background: #d35400; color: white; }
        .ruins { top: 45%; left: 55%; background: #16a085; color: white; }
        .treasure { top: 75%; left: 25%; background: #f1c40f; color: #2c3e50; }
        
        .path {
            position: absolute;
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
            transform-origin: left center;
            z-index: 5;
            transition: width 0.5s ease;
        }
        
        .character {
            position: absolute;
            width: 24px;
            height: 24px;
            background: var(--primary);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 1.5s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 15;
            border: 2px solid white;
        }
        
        /* 控制台区域 */
        .console-section {
            padding: 25px;
            display: flex;
            flex-direction: column;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            background: var(--primary);
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #bdc3c7;
            color: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .secondary-btn {
            background: var(--secondary);
        }
        
        .tertiary-btn {
            background: var(--accent);
        }
        
        .progress-container {
            margin-bottom: 20px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .progress-bar {
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 5px;
            width: 0%;
            transition: width 0.8s ease;
        }
        
        .status-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border-left: 4px solid var(--primary);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .status-card:nth-child(2) {
            border-left-color: var(--secondary);
        }
        
        .status-card:nth-child(3) {
            border-left-color: var(--accent);
        }
        
        .status-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 5px 0;
            color: var(--dark);
        }
        
        .status-label {
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        .log-container {
            flex: 1;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            min-height: 200px;
            max-height: 300px;
        }
        
        .log-entry {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 6px;
            background: white;
            animation: fadeIn 0.3s;
            border-left: 4px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .log-entry.success { border-left-color: var(--secondary); }
        .log-entry.warning { border-left-color: var(--accent); }
        .log-entry.error { border-left-color: #e74c3c; }
        .log-entry.info { border-left-color: var(--primary); }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* 响应式设计 */
        @media (max-width: 900px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .map-section {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
        }
        
        @media (max-width: 600px) {
            .controls {
                flex-direction: column;
            }
            
            .status-cards {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>秘境寻踪</h1>
            <div class="subtitle">异步寻宝探险</div>
        </header>
        
        <div class="content">
            <section class="map-section">
                <div class="section-title">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>探险地图</span>
                </div>
                <div class="map-container">
                    <div class="map-grid"></div>
                    <div class="path" id="path1"></div>
                    <div class="path" id="path2"></div>
                    <div class="path" id="path3"></div>
                    <div class="path" id="path4"></div>
                    
                    <div class="location library"><i class="fas fa-book"></i></div>
                    <div class="location cave"><i class="fas fa-mountain"></i></div>
                    <div class="location temple"><i class="fas fa-place-of-worship"></i></div>
                    <div class="location ruins"><i class="fas fa-monument"></i></div>
                    <div class="location treasure"><i class="fas fa-gem"></i></div>
                    
                    <div class="character" id="character"></div>
                </div>
            </section>
            
            <section class="console-section">
                <div class="section-title">
                    <i class="fas fa-terminal"></i>
                    <span>控制台</span>
                </div>
                
                <div class="controls">
                    <button id="startBtn"><i class="fas fa-play"></i> 开始探险</button>
                    <button id="pauseBtn" class="secondary-btn" disabled><i class="fas fa-pause"></i> 暂停</button>
                    <button id="resetBtn" class="tertiary-btn"><i class="fas fa-redo"></i> 重置</button>
                </div>
                
                <div class="progress-container">
                    <div class="progress-label">
                        <span>探险进度</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
                
                <div class="status-cards">
                    <div class="status-card">
                        <div class="status-label">当前步骤</div>
                        <div class="status-value" id="currentStep">0/5</div>
                    </div>
                    <div class="status-card">
                        <div class="status-label">发现线索</div>
                        <div class="status-value" id="cluesFound">0</div>
                    </div>
                    <div class="status-card">
                        <div class="status-label">探险时间</div>
                        <div class="status-value" id="explorationTime">00:00</div>
                    </div>
                </div>
                
                <div class="section-title">
                    <i class="fas fa-scroll"></i>
                    <span>探险日志</span>
                </div>
                <div class="log-container" id="logContainer">
                    <div class="log-entry info"><i class="fas fa-info-circle"></i> 系统就绪，等待开始探险...</div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // 扩展宝藏地图API
        class TreasureMap {
            static async getInitialClue() {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve("在古老的图书馆里找到了第一个线索：一张泛黄的地图，指向一个神秘洞穴...");
                    }, 1500);
                });
            }

            static async exploreMysteriousCave(clue) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (!clue) {
                            reject("没有线索，无法探索洞穴!");
                        }
                        // 30%几率遇到危险
                        if (Math.random() < 0.3) {
                            reject("洞穴探险失败! 遇到了落石陷阱!");
                        }
                        resolve("成功探索洞穴! 发现了一组古老的符文...");
                    }, 2000);
                });
            }

            static async decodeAncientScript(script) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (!script) {
                            reject("没有符文可以解码!");
                        }
                        resolve("解码成功! 符文指向一座被遗忘的神庙...");
                    }, 1800);
                });
            }

            static async searchTemple(location) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const random = Math.random();
                        if (random < 0.4) {
                            reject("糟糕!遇到了神庙守护者! 需要想办法绕过它...");
                        }
                        resolve("在神庙深处找到了一个神秘的箱子，但需要解开谜题才能打开...");
                    }, 2200);
                });
            }

            static async solvePuzzle(box) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (!box) {
                            reject("没有找到箱子，无法解谜!");
                        }
                        // 20%几率解谜失败
                        if (Math.random() < 0.2) {
                            reject("谜题太难了! 需要更多时间思考...");
                        }
                        resolve("成功解开谜题! 箱子打开了，里面是...");
                    }, 2500);
                });
            }

            static async openTreasureBox() {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve("恭喜!你找到了传说中的宝藏 - 一颗发光的魔法宝石!");
                    }, 1500);
                });
            }
        }

        // 游戏状态管理
        class TreasureGame {
            constructor() {
                this.stepCount = 0;
                this.totalSteps = 5;
                this.isPlaying = false;
                this.isPaused = false;
                this.startTime = null;
                this.timerInterval = null;
                
                this.locations = document.querySelectorAll('.location');
                this.character = document.getElementById('character');
                this.logContainer = document.getElementById('logContainer');
                this.currentStepElement = document.getElementById('currentStep');
                this.cluesFoundElement = document.getElementById('cluesFound');
                this.explorationTimeElement = document.getElementById('explorationTime');
                this.progressFill = document.getElementById('progressFill');
                this.progressPercent = document.getElementById('progressPercent');
                
                this.startBtn = document.getElementById('startBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.resetBtn = document.getElementById('resetBtn');
                
                this.setupEventListeners();
                this.resetGame();
            }
            
            setupEventListeners() {
                this.startBtn.addEventListener('click', () => this.startAdventure());
                this.pauseBtn.addEventListener('click', () => this.togglePause());
                this.resetBtn.addEventListener('click', () => this.resetGame());
            }
            
            resetGame() {
                this.stepCount = 0;
                this.isPlaying = false;
                this.isPaused = false;
                this.updateStepCounter();
                this.updateProgressBar();
                this.logContainer.innerHTML = '<div class="log-entry info"><i class="fas fa-info-circle"></i> 系统就绪，等待开始探险...</div>';
                this.character.style.top = '50%';
                this.character.style.left = '50%';
                this.cluesFoundElement.textContent = '0';
                this.explorationTimeElement.textContent = '00:00';
                
                this.locations.forEach(loc => loc.classList.remove('active'));
                this.startBtn.disabled = false;
                this.pauseBtn.disabled = true;
                this.pauseBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停';
                
                // 重置路径
                document.querySelectorAll('.path').forEach(path => {
                    path.style.width = '0';
                });
                
                clearInterval(this.timerInterval);
                this.addLog("游戏已重置，准备开始新的冒险!", "info");
            }
            
            startAdventure() {
                if (this.isPlaying) return;
                
                this.isPlaying = true;
                this.startBtn.disabled = true;
                this.pauseBtn.disabled = false;
                this.startTime = new Date();
                
                this.startTimer();
                this.addLog("🚀 寻宝冒险开始!", "info");
                
                this.executeAdventure();
            }
            
            async executeAdventure() {
                try {
                    // 第一步：获取初始线索
                    await this.moveToLocation(0); // 图书馆
                    const clue = await TreasureMap.getInitialClue();
                    this.addLog(clue, "success");
                    this.updateStepCounter(1);
                    
                    // 第二步：探索神秘洞穴
                    await this.moveToLocation(1); // 洞穴
                    const caveResult = await TreasureMap.exploreMysteriousCave(clue);
                    this.addLog(caveResult, "success");
                    this.updateStepCounter(2);
                    
                    // 第三步：解码古老符文
                    await this.moveToLocation(3); // 废墟
                    const decoded = await TreasureMap.decodeAncientScript(caveResult);
                    this.addLog(decoded, "success");
                    this.updateStepCounter(3);
                    
                    // 第四步：搜索神庙
                    await this.moveToLocation(2); // 神庙
                    const templeResult = await TreasureMap.searchTemple(decoded);
                    this.addLog(templeResult, "success");
                    this.updateStepCounter(4);
                    
                    // 第五步：解开谜题
                    const puzzleResult = await TreasureMap.solvePuzzle(templeResult);
                    this.addLog(puzzleResult, "success");
                    this.updateStepCounter(5);
                    
                    // 最后：打开宝藏
                    await this.moveToLocation(4); // 宝藏
                    const treasure = await TreasureMap.openTreasureBox();
                    this.addLog(treasure, "success");
                    
                    // 显示成功消息
                    this.addLog("🎉 恭喜你成功找到宝藏! 🎉", "success");
                    this.celebrate();
                    
                } catch (error) {
                    this.addLog(`任务失败: ${error}`, "error");
                    this.addLog("冒险中断了，点击重置按钮再试一次!", "warning");
                } finally {
                    this.pauseBtn.disabled = true;
                }
            }
            
            async moveToLocation(locationIndex) {
                if (this.isPaused) {
                    await this.waitForResume();
                }
                
                const targetLocation = this.locations[locationIndex];
                const rect = targetLocation.getBoundingClientRect();
                const mapRect = document.querySelector('.map-container').getBoundingClientRect();
                
                // 计算目标位置（相对于地图容器）
                const top = rect.top - mapRect.top + rect.height / 2;
                const left = rect.left - mapRect.left + rect.width / 2;
                
                // 激活目标地点
                this.locations.forEach(loc => loc.classList.remove('active'));
                targetLocation.classList.add('active');
                
                // 绘制路径
                if (locationIndex > 0) {
                    this.drawPath(locationIndex);
                }
                
                // 移动角色
                this.character.style.top = `${top}px`;
                this.character.style.left = `${left}px`;
                
                // 等待移动动画完成
                return new Promise(resolve => {
                    setTimeout(resolve, 1500);
                });
            }
            
            drawPath(toIndex) {
                const fromIndex = toIndex - 1;
                const fromLoc = this.locations[fromIndex];
                const toLoc = this.locations[toIndex];
                
                const fromRect = fromLoc.getBoundingClientRect();
                const toRect = toLoc.getBoundingClientRect();
                const mapRect = document.querySelector('.map-container').getBoundingClientRect();
                
                const fromX = fromRect.left - mapRect.left + fromRect.width / 2;
                const fromY = fromRect.top - mapRect.top + fromRect.height / 2;
                const toX = toRect.left - mapRect.left + toRect.width / 2;
                const toY = toRect.top - mapRect.top + toRect.height / 2;
                
                // 计算距离和角度
                const distance = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
                const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
                
                // 获取路径元素
                const path = document.getElementById(`path${toIndex}`);
                path.style.width = `${distance}px`;
                path.style.left = `${fromX}px`;
                path.style.top = `${fromY}px`;
                path.style.transform = `rotate(${angle}deg)`;
            }
            
            togglePause() {
                this.isPaused = !this.isPaused;
                
                if (this.isPaused) {
                    this.pauseBtn.innerHTML = '<i class="fas fa-play"></i> 继续';
                    this.addLog("探险已暂停", "warning");
                } else {
                    this.pauseBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停';
                    this.addLog("探险继续", "info");
                }
            }
            
            waitForResume() {
                return new Promise(resolve => {
                    const checkResume = setInterval(() => {
                        if (!this.isPaused) {
                            clearInterval(checkResume);
                            resolve();
                        }
                    }, 100);
                });
            }
            
            startTimer() {
                this.timerInterval = setInterval(() => {
                    if (!this.isPaused && this.startTime) {
                        const now = new Date();
                        const diff = Math.floor((now - this.startTime) / 1000);
                        const minutes = Math.floor(diff / 60).toString().padStart(2, '0');
                        const seconds = (diff % 60).toString().padStart(2, '0');
                        this.explorationTimeElement.textContent = `${minutes}:${seconds}`;
                    }
                }, 1000);
            }
            
            addLog(message, type) {
                const icons = {
                    success: 'check-circle',
                    warning: 'exclamation-triangle',
                    error: 'times-circle',
                    info: 'info-circle'
                };
                
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                logEntry.innerHTML = `<i class="fas fa-${icons[type]}"></i> [${new Date().toLocaleTimeString()}] ${message}`;
                this.logContainer.appendChild(logEntry);
                this.logContainer.scrollTop = this.logContainer.scrollHeight;
                
                // 更新线索计数
                if (type === 'success' && message.includes('线索') || message.includes('发现')) {
                    this.cluesFoundElement.textContent = parseInt(this.cluesFoundElement.textContent) + 1;
                }
            }
            
            updateStepCounter(step) {
                if (step) {
                    this.stepCount = step;
                }
                this.currentStepElement.textContent = `${this.stepCount}/${this.totalSteps}`;
                this.updateProgressBar();
            }
            
            updateProgressBar() {
                const percent = (this.stepCount / this.totalSteps) * 100;
                this.progressFill.style.width = `${percent}%`;
                this.progressPercent.textContent = `${Math.round(percent)}%`;
            }
            
            celebrate() {
                // 简单的庆祝效果 - 使宝藏位置脉动
                const treasure = document.querySelector('.treasure');
                treasure.classList.add('pulse');
                
                // 添加成功日志
                setTimeout(() => {
                    this.addLog("探险完成! 你是一位出色的宝藏猎人!", "success");
                }, 1000);
            }
        }

        // 初始化游戏
        document.addEventListener('DOMContentLoaded', () => {
            new TreasureGame();
        });
    </script>
</body>
</html>